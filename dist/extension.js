(()=>{"use strict";var e={651:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebugSession=t.ErrorDestination=t.MemoryEvent=t.InvalidatedEvent=t.ProgressEndEvent=t.ProgressUpdateEvent=t.ProgressStartEvent=t.CapabilitiesEvent=t.LoadedSourceEvent=t.ModuleEvent=t.BreakpointEvent=t.ThreadEvent=t.OutputEvent=t.ExitedEvent=t.TerminatedEvent=t.InitializedEvent=t.ContinuedEvent=t.StoppedEvent=t.CompletionItem=t.Module=t.Breakpoint=t.Variable=t.Thread=t.StackFrame=t.Scope=t.Source=void 0;const r=n(147),s=n(601),i=n(153),o=n(310);t.Source=class{constructor(e,t,n=0,r,s){this.name=e,this.path=t,this.sourceReference=n,r&&(this.origin=r),s&&(this.adapterData=s)}},t.Scope=class{constructor(e,t,n=!1){this.name=e,this.variablesReference=t,this.expensive=n}},t.StackFrame=class{constructor(e,t,n,r=0,s=0){this.id=e,this.source=n,this.line=r,this.column=s,this.name=t}},t.Thread=class{constructor(e,t){this.id=e,this.name=t||"Thread #"+e}},t.Variable=class{constructor(e,t,n=0,r,s){this.name=e,this.value=t,this.variablesReference=n,"number"==typeof s&&(this.namedVariables=s),"number"==typeof r&&(this.indexedVariables=r)}},t.Breakpoint=class{constructor(e,t,n,r){this.verified=e;const s=this;"number"==typeof t&&(s.line=t),"number"==typeof n&&(s.column=n),r&&(s.source=r)}setId(e){this.id=e}},t.Module=class{constructor(e,t){this.id=e,this.name=t}},t.CompletionItem=class{constructor(e,t,n=0){this.label=e,this.start=t,this.length=n}};class a extends s.Event{constructor(e,t,n){super("stopped"),this.body={reason:e},"number"==typeof t&&(this.body.threadId=t),"string"==typeof n&&(this.body.text=n)}}t.StoppedEvent=a;class u extends s.Event{constructor(e,t){super("continued"),this.body={threadId:e},"boolean"==typeof t&&(this.body.allThreadsContinued=t)}}t.ContinuedEvent=u;class c extends s.Event{constructor(){super("initialized")}}t.InitializedEvent=c;class l extends s.Event{constructor(e){super("terminated"),("boolean"==typeof e||e)&&(this.body={restart:e})}}t.TerminatedEvent=l;class d extends s.Event{constructor(e){super("exited"),this.body={exitCode:e}}}t.ExitedEvent=d;class h extends s.Event{constructor(e,t="console",n){super("output"),this.body={category:t,output:e},void 0!==n&&(this.body.data=n)}}t.OutputEvent=h;class p extends s.Event{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}}t.ThreadEvent=p;class m extends s.Event{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}}t.BreakpointEvent=m;class g extends s.Event{constructor(e,t){super("module"),this.body={reason:e,module:t}}}t.ModuleEvent=g;class f extends s.Event{constructor(e,t){super("loadedSource"),this.body={reason:e,source:t}}}t.LoadedSourceEvent=f;class v extends s.Event{constructor(e){super("capabilities"),this.body={capabilities:e}}}t.CapabilitiesEvent=v;class b extends s.Event{constructor(e,t,n){super("progressStart"),this.body={progressId:e,title:t},"string"==typeof n&&(this.body.message=n)}}t.ProgressStartEvent=b;class y extends s.Event{constructor(e,t){super("progressUpdate"),this.body={progressId:e},"string"==typeof t&&(this.body.message=t)}}t.ProgressUpdateEvent=y;class E extends s.Event{constructor(e,t){super("progressEnd"),this.body={progressId:e},"string"==typeof t&&(this.body.message=t)}}t.ProgressEndEvent=E;class R extends s.Event{constructor(e,t,n){super("invalidated"),this.body={},e&&(this.body.areas=e),t&&(this.body.threadId=t),n&&(this.body.stackFrameId=n)}}t.InvalidatedEvent=R;class w extends s.Event{constructor(e,t,n){super("memory"),this.body={memoryReference:e,offset:t,count:n}}}var S;t.MemoryEvent=w,function(e){e[e.User=1]="User",e[e.Telemetry=2]="Telemetry"}(S=t.ErrorDestination||(t.ErrorDestination={}));class _ extends r.ProtocolServer{constructor(e,t){super();const n="boolean"==typeof e&&e;this._debuggerLinesStartAt1=n,this._debuggerColumnsStartAt1=n,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer="boolean"==typeof t&&t,this.on("close",(()=>{this.shutdown()})),this.on("error",(e=>{this.shutdown()}))}setDebuggerPathFormat(e){this._debuggerPathsAreURIs="path"!==e}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){(0,i.runDebugAdapter)(e)}shutdown(){this._isServer||this._isRunningInline()||setTimeout((()=>{process.exit(0)}),100)}sendErrorResponse(e,t,n,r,s=S.User){let i;"number"==typeof t?(i={id:t,format:n},r&&(i.variables=r),s&S.User&&(i.showUser=!0),s&S.Telemetry&&(i.sendTelemetry=!0)):i=t,e.success=!1,e.message=_.formatPII(i.format,!0,i.variables),e.body||(e.body={}),e.body.error=i,this.sendResponse(e)}runInTerminalRequest(e,t,n){this.sendRequest("runInTerminal",e,t,n)}dispatchRequest(e){const t=new s.Response(e);try{if("initialize"===e.command){var n=e.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,S.Telemetry);else{const e=t;e.body={},this.initializeRequest(e,n)}}else"launch"===e.command?this.launchRequest(t,e.arguments,e):"attach"===e.command?this.attachRequest(t,e.arguments,e):"disconnect"===e.command?this.disconnectRequest(t,e.arguments,e):"terminate"===e.command?this.terminateRequest(t,e.arguments,e):"restart"===e.command?this.restartRequest(t,e.arguments,e):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments,e):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments,e):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments,e):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments,e):"continue"===e.command?this.continueRequest(t,e.arguments,e):"next"===e.command?this.nextRequest(t,e.arguments,e):"stepIn"===e.command?this.stepInRequest(t,e.arguments,e):"stepOut"===e.command?this.stepOutRequest(t,e.arguments,e):"stepBack"===e.command?this.stepBackRequest(t,e.arguments,e):"reverseContinue"===e.command?this.reverseContinueRequest(t,e.arguments,e):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments,e):"goto"===e.command?this.gotoRequest(t,e.arguments,e):"pause"===e.command?this.pauseRequest(t,e.arguments,e):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments,e):"scopes"===e.command?this.scopesRequest(t,e.arguments,e):"variables"===e.command?this.variablesRequest(t,e.arguments,e):"setVariable"===e.command?this.setVariableRequest(t,e.arguments,e):"setExpression"===e.command?this.setExpressionRequest(t,e.arguments,e):"source"===e.command?this.sourceRequest(t,e.arguments,e):"threads"===e.command?this.threadsRequest(t,e):"terminateThreads"===e.command?this.terminateThreadsRequest(t,e.arguments,e):"evaluate"===e.command?this.evaluateRequest(t,e.arguments,e):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments,e):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments,e):"completions"===e.command?this.completionsRequest(t,e.arguments,e):"exceptionInfo"===e.command?this.exceptionInfoRequest(t,e.arguments,e):"loadedSources"===e.command?this.loadedSourcesRequest(t,e.arguments,e):"dataBreakpointInfo"===e.command?this.dataBreakpointInfoRequest(t,e.arguments,e):"setDataBreakpoints"===e.command?this.setDataBreakpointsRequest(t,e.arguments,e):"readMemory"===e.command?this.readMemoryRequest(t,e.arguments,e):"writeMemory"===e.command?this.writeMemoryRequest(t,e.arguments,e):"disassemble"===e.command?this.disassembleRequest(t,e.arguments,e):"cancel"===e.command?this.cancelRequest(t,e.arguments,e):"breakpointLocations"===e.command?this.breakpointLocationsRequest(t,e.arguments,e):"setInstructionBreakpoints"===e.command?this.setInstructionBreakpointsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack},S.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,e.body.supportsClipboardContext=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsExceptionFilterOptions=!1,this.sendResponse(e)}disconnectRequest(e,t,n){this.sendResponse(e),this.shutdown()}launchRequest(e,t,n){this.sendResponse(e)}attachRequest(e,t,n){this.sendResponse(e)}terminateRequest(e,t,n){this.sendResponse(e)}restartRequest(e,t,n){this.sendResponse(e)}setBreakPointsRequest(e,t,n){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,n){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,n){this.sendResponse(e)}configurationDoneRequest(e,t,n){this.sendResponse(e)}continueRequest(e,t,n){this.sendResponse(e)}nextRequest(e,t,n){this.sendResponse(e)}stepInRequest(e,t,n){this.sendResponse(e)}stepOutRequest(e,t,n){this.sendResponse(e)}stepBackRequest(e,t,n){this.sendResponse(e)}reverseContinueRequest(e,t,n){this.sendResponse(e)}restartFrameRequest(e,t,n){this.sendResponse(e)}gotoRequest(e,t,n){this.sendResponse(e)}pauseRequest(e,t,n){this.sendResponse(e)}sourceRequest(e,t,n){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,n){this.sendResponse(e)}stackTraceRequest(e,t,n){this.sendResponse(e)}scopesRequest(e,t,n){this.sendResponse(e)}variablesRequest(e,t,n){this.sendResponse(e)}setVariableRequest(e,t,n){this.sendResponse(e)}setExpressionRequest(e,t,n){this.sendResponse(e)}evaluateRequest(e,t,n){this.sendResponse(e)}stepInTargetsRequest(e,t,n){this.sendResponse(e)}gotoTargetsRequest(e,t,n){this.sendResponse(e)}completionsRequest(e,t,n){this.sendResponse(e)}exceptionInfoRequest(e,t,n){this.sendResponse(e)}loadedSourcesRequest(e,t,n){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,n){this.sendResponse(e)}setDataBreakpointsRequest(e,t,n){this.sendResponse(e)}readMemoryRequest(e,t,n){this.sendResponse(e)}writeMemoryRequest(e,t,n){this.sendResponse(e)}disassembleRequest(e,t,n){this.sendResponse(e)}cancelRequest(e,t,n){this.sendResponse(e)}breakpointLocationsRequest(e,t,n){this.sendResponse(e)}setInstructionBreakpointsRequest(e,t,n){this.sendResponse(e)}customRequest(e,t,n,r){this.sendErrorResponse(t,1014,"unrecognized request",null,S.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?_.uri2path(e):_.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?_.uri2path(e):_.path2uri(e):e}static path2uri(e){"win32"===process.platform&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new o.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new o.URL(e),n=decodeURIComponent(t.pathname);return"win32"===process.platform&&(/^\/[a-zA-Z]:/.test(n)&&(n=n[1].toLowerCase()+n.substr(2)),n=n.replace(/\//g,"\\")),n}static formatPII(e,t,n){return e.replace(_._formatPIIRegexp,(function(e,r){return t&&r.length>0&&"_"!==r[0]?e:n[r]&&n.hasOwnProperty(r)?n[r]:e}))}}t.DebugSession=_,_._formatPIIRegexp=/{([^}]+)}/g},527:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Handles=void 0,t.Handles=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle="number"==typeof e?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}}},309:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InternalLogger=void 0;const r=n(358),s=n(17),i=n(100);function o(){let e=new Date;return a(2,String(e.getUTCHours()))+":"+a(2,String(e.getUTCMinutes()))+":"+a(2,String(e.getUTCSeconds()))+"."+a(3,String(e.getUTCMilliseconds()))+" UTC"}function a(e,t){return t.length>=e?t:String("0".repeat(e)+t).slice(-e)}t.InternalLogger=class{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=i.LogLevel.Warn,this.disposeCallback=(e,t)=>{this.dispose(),t=t||2,t+=128,process.exit(t)}}async setup(e){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(s.isAbsolute(e.logFilePath)){const t=t=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${t.toString()}\n`,i.LogLevel.Error);try{await r.promises.mkdir(s.dirname(e.logFilePath),{recursive:!0}),this.log("Verbose logs are written to:\n",i.LogLevel.Warn),this.log(e.logFilePath+"\n",i.LogLevel.Warn),this._logFileStream=r.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",(e=>{t(e)}))}catch(e){t(e)}}else this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,i.LogLevel.Error)}logDateTime(){let e=new Date;const t=e.getUTCFullYear()+"-"+`${e.getUTCMonth()+1}-`+e.getUTCDate()+", "+o();this.log(t+"\n",i.LogLevel.Verbose,!1)}setupShutdownListeners(){process.on("beforeExit",this.beforeExitCallback),process.on("SIGTERM",this.disposeCallback),process.on("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise((e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()}))}log(e,t,n=!0){if(this._minLogLevel!==i.LogLevel.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){const n=t===i.LogLevel.Error?console.error:t===i.LogLevel.Warn?console.warn:null;n&&n((0,i.trimLastNewline)(e))}t===i.LogLevel.Error&&(e=`[${i.LogLevel[t]}] ${e}`),this._prependTimestamp&&n&&(e="["+o()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){const t=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",t&&(e+="\n")}if(this._logCallback){const n=new i.LogOutputEvent(e,t);this._logCallback(n)}}}},100:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trimLastNewline=t.LogOutputEvent=t.logger=t.Logger=t.LogLevel=void 0;const r=n(309),s=n(651);var i;!function(e){e[e.Verbose=0]="Verbose",e[e.Log=1]="Log",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.Stop=4]="Stop"}(i=t.LogLevel||(t.LogLevel={}));class o{constructor(){this._pendingLogQ=[]}log(e,t=i.Log){e+="\n",this._write(e,t)}verbose(e){this.log(e,i.Verbose)}warn(e){this.log(e,i.Warn)}error(e){this.log(e,i.Error)}dispose(){if(this._currentLogger){const e=this._currentLogger.dispose();return this._currentLogger=null,e}return Promise.resolve()}_write(e,t=i.Log){e+="",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,n=!0){const r="string"==typeof t?t:t&&this._logFilePathFromInit;if(this._currentLogger){const t={consoleMinLogLevel:e,logFilePath:r,prependTimestamp:n};this._currentLogger.setup(t).then((()=>{if(this._pendingLogQ){const e=this._pendingLogQ;this._pendingLogQ=null,e.forEach((e=>this._write(e.msg,e.level)))}}))}}init(e,t,n){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new r.InternalLogger(e,n),this._logFilePathFromInit=t}}t.Logger=o,t.logger=new o;class a extends s.OutputEvent{constructor(e,t){super(e,t===i.Error?"stderr":t===i.Warn?"console":"stdout")}}t.LogOutputEvent=a,t.trimLastNewline=function(e){return e.replace(/(\n|\r\n)$/,"")}},212:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingDebugSession=void 0;const r=n(100),s=r.logger,i=n(651);class o extends i.DebugSession{constructor(e,t,n){super(t,n),this.obsolete_logFilePath=e,this.on("error",(e=>{s.error(e.body)}))}start(e,t){super.start(e,t),s.init((e=>this.sendEvent(e)),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof r.LogOutputEvent)){let t=e;e instanceof i.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t={...e},t.body={...e.body,output:"<output not logged>"}),s.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,n,r){s.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${n}`),super.sendRequest(e,t,n,r)}sendResponse(e){s.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){s.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}}t.LoggingDebugSession=o},955:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Handles=t.Response=t.Event=t.ErrorDestination=t.CompletionItem=t.Module=t.Source=t.Breakpoint=t.Variable=t.Scope=t.StackFrame=t.Thread=t.MemoryEvent=t.InvalidatedEvent=t.ProgressEndEvent=t.ProgressUpdateEvent=t.ProgressStartEvent=t.CapabilitiesEvent=t.LoadedSourceEvent=t.ModuleEvent=t.BreakpointEvent=t.ThreadEvent=t.OutputEvent=t.ContinuedEvent=t.StoppedEvent=t.ExitedEvent=t.TerminatedEvent=t.InitializedEvent=t.logger=t.Logger=t.LoggingDebugSession=t.DebugSession=void 0;const r=n(651);Object.defineProperty(t,"DebugSession",{enumerable:!0,get:function(){return r.DebugSession}}),Object.defineProperty(t,"InitializedEvent",{enumerable:!0,get:function(){return r.InitializedEvent}}),Object.defineProperty(t,"TerminatedEvent",{enumerable:!0,get:function(){return r.TerminatedEvent}}),Object.defineProperty(t,"ExitedEvent",{enumerable:!0,get:function(){return r.ExitedEvent}}),Object.defineProperty(t,"StoppedEvent",{enumerable:!0,get:function(){return r.StoppedEvent}}),Object.defineProperty(t,"ContinuedEvent",{enumerable:!0,get:function(){return r.ContinuedEvent}}),Object.defineProperty(t,"OutputEvent",{enumerable:!0,get:function(){return r.OutputEvent}}),Object.defineProperty(t,"ThreadEvent",{enumerable:!0,get:function(){return r.ThreadEvent}}),Object.defineProperty(t,"BreakpointEvent",{enumerable:!0,get:function(){return r.BreakpointEvent}}),Object.defineProperty(t,"ModuleEvent",{enumerable:!0,get:function(){return r.ModuleEvent}}),Object.defineProperty(t,"LoadedSourceEvent",{enumerable:!0,get:function(){return r.LoadedSourceEvent}}),Object.defineProperty(t,"CapabilitiesEvent",{enumerable:!0,get:function(){return r.CapabilitiesEvent}}),Object.defineProperty(t,"ProgressStartEvent",{enumerable:!0,get:function(){return r.ProgressStartEvent}}),Object.defineProperty(t,"ProgressUpdateEvent",{enumerable:!0,get:function(){return r.ProgressUpdateEvent}}),Object.defineProperty(t,"ProgressEndEvent",{enumerable:!0,get:function(){return r.ProgressEndEvent}}),Object.defineProperty(t,"InvalidatedEvent",{enumerable:!0,get:function(){return r.InvalidatedEvent}}),Object.defineProperty(t,"MemoryEvent",{enumerable:!0,get:function(){return r.MemoryEvent}}),Object.defineProperty(t,"Thread",{enumerable:!0,get:function(){return r.Thread}}),Object.defineProperty(t,"StackFrame",{enumerable:!0,get:function(){return r.StackFrame}}),Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return r.Scope}}),Object.defineProperty(t,"Variable",{enumerable:!0,get:function(){return r.Variable}}),Object.defineProperty(t,"Breakpoint",{enumerable:!0,get:function(){return r.Breakpoint}}),Object.defineProperty(t,"Source",{enumerable:!0,get:function(){return r.Source}}),Object.defineProperty(t,"Module",{enumerable:!0,get:function(){return r.Module}}),Object.defineProperty(t,"CompletionItem",{enumerable:!0,get:function(){return r.CompletionItem}}),Object.defineProperty(t,"ErrorDestination",{enumerable:!0,get:function(){return r.ErrorDestination}});const s=n(212);Object.defineProperty(t,"LoggingDebugSession",{enumerable:!0,get:function(){return s.LoggingDebugSession}});const i=n(100);t.Logger=i;const o=n(601);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return o.Event}}),Object.defineProperty(t,"Response",{enumerable:!0,get:function(){return o.Response}});const a=n(527);Object.defineProperty(t,"Handles",{enumerable:!0,get:function(){return a.Handles}});const u=i.logger;t.logger=u},601:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Event=t.Response=t.Message=void 0;class n{constructor(e){this.seq=0,this.type=e}}t.Message=n,t.Response=class extends n{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}},t.Event=class extends n{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}}},147:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProtocolServer=void 0;const r=n(361),s=n(601);class i{get event(){return this._event||(this._event=(e,t)=>{let n;return this._listener=e,this._this=t,n={dispose:()=>{this._listener=void 0,this._this=void 0}},n}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch(e){}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}}class o extends r.EventEmitter{constructor(){super(),this._sendMessage=new i,this._sequence=1,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if("request"===e.type)this.dispatchRequest(e);else if("response"===e.type){const t=e,n=this._pendingRequests.get(t.request_seq);n&&(this._pendingRequests.delete(t.request_seq),n(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._writableStream=t,this._rawData=Buffer.alloc(0),e.on("data",(e=>this._handleData(e))),e.on("close",(()=>{this._emitEvent(new s.Event("close"))})),e.on("error",(e=>{this._emitEvent(new s.Event("error","inStream error: "+(e&&e.message)))})),t.on("error",(e=>{this._emitEvent(new s.Event("error","outStream error: "+(e&&e.message)))})),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,n,r){const i={command:e};if(t&&Object.keys(t).length>0&&(i.arguments=t),this._send("request",i),r){this._pendingRequests.set(i.seq,r);const e=setTimeout((()=>{clearTimeout(e);const t=this._pendingRequests.get(i.seq);t&&(this._pendingRequests.delete(i.seq),t(new s.Response(i,"timeout")))}),n)}}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){const e=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(e,"utf8")}\r\n\r\n${e}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){const e=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,e.length>0)try{let t=JSON.parse(e);this.handleMessage(t)}catch(e){this._emitEvent(new s.Event("error","Error handling data: "+(e&&e.message)))}continue}}else{const e=this._rawData.indexOf(o.TWO_CRLF);if(-1!==e){const t=this._rawData.toString("utf8",0,e).split("\r\n");for(let e=0;e<t.length;e++){const n=t[e].split(/: +/);"Content-Length"==n[0]&&(this._contentLength=+n[1])}this._rawData=this._rawData.slice(e+o.TWO_CRLF.length);continue}}break}}}t.ProtocolServer=o,o.TWO_CRLF="\r\n\r\n"},153:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runDebugAdapter=void 0;const r=n(808);t.runDebugAdapter=function(e){let t=0;if(process.argv.slice(2).forEach((function(e,n,r){const s=/^--server=(\d{4,5})$/.exec(e);s&&(t=parseInt(s[1],10))})),t>0)console.error(`waiting for debug protocol on port ${t}`),r.createServer((t=>{console.error(">> accepted connection from client"),t.on("end",(()=>{console.error(">> client connection closed\n")}));const n=new e(!1,!0);n.setRunAsServer(!0),n.start(t,t)})).listen(t);else{const t=new e(!1);process.on("SIGTERM",(()=>{t.shutdown()})),t.start(process.stdin,process.stdout)}}},324:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.activateDebug=void 0;const r=n(496),s=n(177);t.activateDebug=function(e,t){e.subscriptions.push(r.commands.registerCommand("extension.amalgam.runEditorContents",(e=>{let t=e;!t&&r.window.activeTextEditor&&(t=r.window.activeTextEditor.document.uri),t&&r.debug.startDebugging(void 0,{type:"amalgam",name:"Run File",request:"launch",program:t.fsPath},{noDebug:!0})})),r.commands.registerCommand("extension.amalgam.debugEditorContents",(e=>{let t=e;!t&&r.window.activeTextEditor&&(t=r.window.activeTextEditor.document.uri),t&&r.debug.startDebugging(void 0,{type:"amalgam",name:"Debug Amalgam",request:"launch",program:t.fsPath,stopOnEntry:!1})}))),e.subscriptions.push(r.commands.registerCommand("extension.amalgam.chooseAmalgamFile",(()=>r.window.showInputBox({placeHolder:"Please enter the name of an Amalgam file in the workspace folder",value:"myfile.amlg"}))));const n=new s.AmalgamConfigurationProvider;e.subscriptions.push(r.debug.registerDebugConfigurationProvider("amalgam",n)),e.subscriptions.push(r.debug.registerDebugConfigurationProvider("amalgam",{provideDebugConfigurations:e=>[{name:"Dynamic Launch",request:"launch",type:"amalgam",program:"${file}",workingDirectory:e},{name:"Another Dynamic Launch",request:"launch",type:"amalgam",program:"${file}",workingDirectory:e},{name:"Amalgam Launch",request:"launch",type:"amalgam",program:"${file}",workingDirectory:e}]},r.DebugConfigurationProviderTriggerKind.Dynamic)),e.subscriptions.push(r.languages.registerEvaluatableExpressionProvider("amalgam",{provideEvaluatableExpression(e,t){const n=/(?<![(#"'a-z0-9_.])(?<name>[_a-z]+[_a-z0-9]*)(?!["'a-z0-9])/gi,s=e.lineAt(t.line).text;let i;e:for(;null!=(i=n.exec(s));)if(i.groups){const e=i.groups.name,n=new r.Range(t.line,i.index,t.line,i.index+e.length),o=/(["'])(?:(?=(\\?))\2.)*?\1/g;let a;for(;null!=(a=o.exec(s));)if(new r.Range(t.line,a.index,t.line,a.index+a[0].length).contains(n))continue e;const u=/;.*$/g;let c;for(;null!=(c=u.exec(s));)if(new r.Range(t.line,c.index,t.line,c.index+c[0].length).contains(n))continue e;if(n.contains(t))return new r.EvaluatableExpression(n)}}})),e.subscriptions.push(r.debug.registerDebugAdapterDescriptorFactory("amalgam",t))}},177:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmalgamConfigurationProvider=void 0;const r=n(496);t.AmalgamConfigurationProvider=class{resolveDebugConfiguration(e,t){if(!t.type&&!t.request&&!t.name){const e=r.window.activeTextEditor;e&&"amalgam"===e.document.languageId&&(t.type="amalgam",t.name="Launch Amalgam",t.request="launch",t.program="${file}",t.stopOnEntry=!1)}return t.program?t:r.window.showInformationMessage("Cannot find a program to debug").then((()=>{}))}}},753:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidRuntimeResponse=t.RuntimeCommandCancelled=t.RuntimeNotStarted=t.RuntimeError=void 0;class n extends Error{constructor(e,t){super(t),this.reason=e,Object.setPrototypeOf(this,new.target.prototype)}}t.RuntimeError=n,t.RuntimeNotStarted=class extends n{constructor(e){super("not started",e),Object.setPrototypeOf(this,new.target.prototype)}},t.RuntimeCommandCancelled=class extends n{constructor(e){super("command cancelled",e),Object.setPrototypeOf(this,new.target.prototype)}},t.InvalidRuntimeResponse=class extends n{constructor(e){super("invalid response",e),Object.setPrototypeOf(this,new.target.prototype)}}},976:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalDebugAdapterFactory=t.InlineDebugAdapterFactory=void 0;const r=n(496),s=n(173);t.InlineDebugAdapterFactory=class{createDebugAdapterDescriptor(e){return new r.DebugAdapterInlineImplementation(new s.AmalgamDebugSession(e))}},t.ExternalDebugAdapterFactory=class{createDebugAdapterDescriptor(e,t){if(!t){const n="~/.amalgam/bin/amalgam",s=["--debug","--debug-sources"],i={cwd:e.workspaceFolder?.uri?.toString()};t=new r.DebugAdapterExecutable(n,s,i)}return t}}},70:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmalgamRuntime=t.RuntimeEntity=t.RuntimeLabel=t.RuntimeVariable=t.RuntimeBreakpointType=t.RuntimeStackType=t.RuntimeEvent=void 0;const r=n(81),s=n(361),i=n(37),o=n(641),a=n(570),u=n(753),c=n(271);var l,d,h;!function(e){e.STOP_ON_ENTRY="stopOnEntry",e.STOP_ON_STEP="stopOnStep",e.STOP_ON_BREAKPOINT="stopOnBreakpoint",e.STOP_ON_EXCEPTION="stopOnException",e.BREAKPOINT_VALIDATED="breakpointValidated",e.OUTPUT="output",e.CONTINUE="continue",e.END="end"}(l||(t.RuntimeEvent=l={})),function(e){e.CALL="Call",e.CONSTRUCTION="Construction",e.INTERPRET_NODE="Interpret node"}(d||(t.RuntimeStackType=d={})),function(e){e.LINE="Line",e.OPCODES="Opcodes",e.LABEL="Label"}(h||(t.RuntimeBreakpointType=h={}));class p{get value(){return this._value}set value(e){this._lazy=!1,this._value=e}get lazy(){return this._lazy}constructor(e,t,n=!1){this.name=e,this._value=t,this._lazy=n,this.category="var"}}t.RuntimeVariable=p;class m extends p{constructor(){super(...arguments),this.category="label"}}t.RuntimeLabel=m;class g extends p{constructor(){super(...arguments),this.category="entity"}}t.RuntimeEntity=g;class f extends s.EventEmitter{get isRunning(){return void 0!==this.cp?.pid}get currentThread(){return this._currentThread}constructor(){super(),this.cp=null,this.ignoreOutput=!1,this.outputBuffer="",this.debugStarted=new c.NotifySubject,this.commandDone=new c.NotifySubject,this.breakpoints=new Map,this.breakpointId=1,this._currentThread=f.DEFAULT_THREAD_ID,this.matchers={end:/\r\r(?:(?<thread>[xa-fA-F0-9]+) )?>$/m,stackFrameComment:/^ {2}comment:src: (?<line>\d+) (?<column>\d+) (?<file>.+)$/gm,stackFrameOpcode:/^ {2}opcode: (?<opcode>.+?)(?: ;src: (?<line>\d+) (?<column>\d+) (?<file>.+))?$/gm,breakpointAction:/^(?<action>Added|Removed) breakpoint for (?:.+)?$/gm,breakpointLine:/^ {2}(?<line>\d+)(?: (?<file>.+))?$/gm,breakpoints:/^(?<type>Line) Breakpoints:\n(?<brs>^(?:\s{2}.+)+)$/gm,stack:/^(?<type>Interpret node) stack:\n(?<frames>^(?:\s{2}.+)+)$/gm,expression:/^(?<value>[\s\S]+)\n{2}$/gm,lines:/^ {2}(?<line>.+)$/gm},this.commandQueue=(0,o.queue)((async e=>{if(void 0===this.cp?.pid)throw new u.RuntimeNotStarted;if(e.signal?.aborted)throw new u.RuntimeCommandCancelled;try{this.activeCommand=e.command;const t=[e.command,...e.args].join(" ");return a.logger.log("stdin",t),this.cp.stdin?.write(t+"\n"),await this.commandDone.wait()}finally{this.activeCommand=void 0}}),1),this.commandQueue.pause()}static getExecutableName(e=""){let t;return t="win32"===(0,i.platform)()?`Amalgam${e}.exe`:`amalgam${e}`,t}async start(e,t,n){this.ignoreOutput=!1;try{this.cp=this.spawnAmalgam(e,n)}catch(e){return a.logger.error(e),!1}if(!this.isRunning)return!1;let r;return n&&(r=this.debugStarted.wait()),this.cp.stdout.on("data",(e=>{this.handleOutput("stdout",e)})),this.cp.stderr.on("data",(e=>{this.handleOutput("stderr",e)})),n&&(null!=r&&await r,await this.verifyBreakpoints(),t?this.sendEvent(l.STOP_ON_ENTRY,this.currentThread):this.continue()),!0}terminate(){this.commandQueue.kill(),this.commandDone.cancel(),this.cp?.pid&&("win32"===(0,i.platform)()?(0,r.spawn)("taskkill",["/pid",this.cp.pid.toString(),"/f","/t"]):this.cp.kill("SIGKILL")),this.cp=null}async quit(){await this.sendCommand("quit")}async finish(){this.sendEvent(l.CONTINUE,this.currentThread),await this.sendCommand("finish")}async continue(){this.sendEvent(l.CONTINUE,this.currentThread),await this.sendCommand("c"),this.sendEvent(l.STOP_ON_BREAKPOINT,this.currentThread)}async step(e){this.sendEvent(l.CONTINUE,this.currentThread),e?(a.logger.warn("Step 'instruction' not yet implemented"),await this.sendCommand("n")):await this.sendCommand("n"),this.sendEvent(l.STOP_ON_STEP,this.currentThread)}async stepIn(){this.sendEvent(l.CONTINUE,this.currentThread),await this.sendCommand("s"),this.sendEvent(l.STOP_ON_STEP,this.currentThread)}async stepOut(e){this.sendEvent(l.CONTINUE,this.currentThread),e?await this.sendCommand("fc"):await this.sendCommand("f"),this.sendEvent(l.STOP_ON_STEP,this.currentThread)}async stack(){const{stack:e}=await this.sendCommand("stack");return null==e?{frames:[],count:0}:e}async getVariables(e){try{let{values:t}=await this.sendCommand("vars",e);return t=Array.from(new Set(t)).sort(),await Promise.all(t.map((async t=>{const{value:n}=await this.sendCommand("pp",e,t);return new p(t,n)})))}catch(e){if(e instanceof u.RuntimeCommandCancelled)return[];throw e}}async getVariable(e,t=!1){const{value:n}=await this.sendCommand("p",e);return t?new m(e,n):new p(e,n)}async getVariableRaw(e,t=!1){const{value:n}=await this.sendCommand("pv",e);return t?new m(e,n):new p(e,n)}async getVariablePreview(e,t=!1){const{value:n}=await this.sendCommand("pp",e);return t?new m(e,n):new p(e,n)}async setVariable(e){let t="";switch(e.category){case"var":t=`(assign (assoc ${e.name} ${e.value}))`;break;case"label":t=`(assign_to_entities (assoc ${e.name} ${e.value}))`}""!==t&&await this.sendCommand("eval",t)}async getLabels(e){let t;return({values:t=[]}=null!=e?await this.sendCommand("labels",e):await this.sendCommand("labels")),t.sort().map((e=>new m(e,void 0,!0)))}async getEntities(){const{values:e=[]}=await this.sendCommand("entities");return e.sort().map((e=>new g(e,void 0,!0)))}async getEntity(e){const{value:t}=await this.sendCommand("entity",e);return new g(e,t)}async evaluate(e){const{value:t}=await this.sendCommand("eval",e);return new p("eval",t)}async getThreadIds(){const{threads:e}=await this.sendCommand("threads");return e}async clearBreakpoints(e){let t=[];if(null==e)for(const[,e]of this.breakpoints)t.push(...e);else t=this.breakpoints.get(e)||[];for(const e of t)e.verified&&await this.sendCommand("bn",e.line,e.path);e?this.breakpoints.delete(e):this.breakpoints.clear()}async setBreakPoint(e,t,n=0){const r={verified:!1,path:e,line:t,column:n,id:this.breakpointId++};let s=this.breakpoints.get(e);if(s||(s=new Array,this.breakpoints.set(e,s)),s.push(r),this.isRunning){const{action:n}=await this.sendCommand("bn",t,e);"added"===n&&(r.verified=!0)}return r}async verifyBreakpoints(e){let t=[];if(null==e)for(const[,e]of this.breakpoints)t.push(...e);else t=this.breakpoints.get(e)||[];for(const e of t)if(!e.verified){const{action:t}=await this.sendCommand("bn",e.line,e.path);"added"===t&&(e.verified=!0,this.sendEvent(l.BREAKPOINT_VALIDATED,e))}}spawnAmalgam(e,t=!0){const{executable:n,args:s=[],program:i}=e,o=[...s,`"${i}"`];t&&o.unshift("--debug-minimal","--debug-sources"),a.logger.debug("Launch args:",o),a.logger.debug("Launch cwd:",e.cwd);const u=(0,r.spawn)(`"${n}"`,o,{cwd:e.cwd,shell:!0,env:{VSCODE_DEBUG_SESSION:"1",...e.env}});return u.stdin?.setDefaultEncoding("utf8"),u.stdout?.setEncoding("utf8"),u.stderr?.setEncoding("utf8"),u.stdout?.on("data",(e=>{a.logger.log("stdout",e)})),u.stderr?.on("data",(e=>{a.logger.log("stderr",e)})),u.on("close",(e=>{a.logger.log("cpinfo",`Child process exited with code: ${e}`),this.sendEvent(l.END)})),u.on("error",(e=>{a.logger.log("cpinfo",`cp.error:${e.message}`)})),u}sendEvent(e,...t){this.emit(e,...t)}async sendCommand(e,t,...n){let r;if(t instanceof AbortSignal){if(t.aborted)throw new u.RuntimeCommandCancelled;r={command:e,args:n,signal:t}}else void 0!==t&&n.unshift(t),r={command:e,args:n};return new Promise(((e,t)=>{this.commandQueue.push(r,((n,r)=>{n?t(n):void 0===r?t(new u.InvalidRuntimeResponse("Command response undefined")):e(r)}))}))}handleOutput(e,t){if(this.ignoreOutput)return;if("stderr"===e)return void this.sendEvent(l.OUTPUT,e,t);t=t.replaceAll("\r\n","\n"),this.outputBuffer+=t,this.outputToDebugConsole(e,t);const n=this.activeCommand;let r,s,i=this.outputBuffer;r=new RegExp(this.matchers.end);const o=r.exec(i);if(null==o)return;if(i=i.substring(0,o.index)+i.substring(o.index+o[0].length+1),null!=o.groups?.thread&&(this._currentThread=parseInt(o.groups?.thread)),null==n)return this.commandQueue.paused&&(this.debugStarted.notify(null),this.commandQueue.resume()),void(this.outputBuffer="");let a;if(["p","pv","pp","eval","entity"].indexOf(n)>=0)for(r=new RegExp(this.matchers.expression);null!=(s=r.exec(i));)s.groups&&(a=s.groups.value);const u=[];if(["vars","labels","entities"].indexOf(n)>=0)for(r=new RegExp(this.matchers.lines);null!=(s=r.exec(i));)s.groups&&u.push(s.groups.line);const c=[];if("br"===n)for(r=new RegExp(this.matchers.breakpoints);null!=(s=r.exec(i));)if(s.groups&&s.groups.type===h.LINE){let e;const t=new RegExp(this.matchers.breakpointLine);for(;e=t.exec(s.groups.brs);)e.groups&&c.push({line:parseInt(e.groups.line),column:0,path:e.groups.file})}let p,m=null;if("bn"===n)for(r=new RegExp(this.matchers.breakpointAction);null!=(s=r.exec(i));)s.groups&&(m=s.groups.action.toLowerCase());if("stack"===n)for(r=new RegExp(this.matchers.stack);null!=(s=r.exec(i));)if(s.groups){if(s.groups.type!==d.INTERPRET_NODE)continue;let e,t,n=0;const r=[],i=[];for(e=new RegExp(this.matchers.stackFrameOpcode);t=e.exec(s.groups.frames);)t.groups&&i.push(t.groups.opcode);for(e=new RegExp(this.matchers.stackFrameComment);t=e.exec(s.groups.frames);)if(t.groups){const e=i[n],s={index:n++,name:e,line:parseInt(t.groups.line),column:parseInt(t.groups.column),file:t.groups.file};r.push(s)}p={frames:r.reverse(),count:r.length}}const g=[];if("threads"===n)for(r=new RegExp(this.matchers.lines);null!=(s=r.exec(i));)s.groups&&g.push(s.groups.line);switch(this.outputBuffer="",n){case"stack":this.commandDone.notify({type:n,stack:p});break;case"threads":this.commandDone.notify({type:n,threads:g});break;case"p":case"pv":case"pp":case"entity":case"eval":this.commandDone.notify({type:n,value:a});break;case"entities":case"labels":case"vars":this.commandDone.notify({type:n,values:u});break;case"bn":this.commandDone.notify({type:n,action:m});break;case"br":this.commandDone.notify({type:n,breakpoints:c});break;default:this.commandDone.notify({type:n})}}outputToDebugConsole(e,t){switch(this.activeCommand){case void 0:case"c":case"s":case"n":case"f":case"fc":case"finish":{const n=new RegExp(this.matchers.end).exec(t);null!=n&&(t=t.substring(0,n.index)+t.substring(n.index+n[0].length+1)),""!==t&&this.sendEvent(l.OUTPUT,e,t)}}}}t.AmalgamRuntime=f,f.DEFAULT_EXECUTABLE_DIRS=["~/.amalgam/bin/"],f.DEFAULT_THREAD_ID=1},173:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmalgamDebugSession=void 0;const r=n(496),s=n(955),i=n(37),o=n(17),a=n(358),u=n(292),c=n(271),l=n(70);class d extends s.LoggingDebugSession{constructor(e){super(),this.configurationDone=new c.NotifySubject,this.cancellationTokens=new Map,this._variableHandles=new s.Handles,this.parentSession=e,this.setDebuggerLinesStartAt1(!1),this.setDebuggerColumnsStartAt1(!1),this.runtime=new l.AmalgamRuntime,this.runtime.on(l.RuntimeEvent.STOP_ON_ENTRY,(e=>{const t=new s.StoppedEvent("entry",e);t.body.allThreadsStopped=!0,this.sendEvent(t)})),this.runtime.on(l.RuntimeEvent.STOP_ON_STEP,(e=>{const t=new s.StoppedEvent("step",e);t.body.allThreadsStopped=!0,this.sendEvent(t)})),this.runtime.on(l.RuntimeEvent.STOP_ON_BREAKPOINT,(e=>{const t=new s.StoppedEvent("breakpoint",e);t.body.allThreadsStopped=!0,this.sendEvent(t)})),this.runtime.on(l.RuntimeEvent.STOP_ON_EXCEPTION,((e,t)=>{let n;n=e?new s.StoppedEvent(`exception(${e})`,t):new s.StoppedEvent("exception",t),n.body.allThreadsStopped=!0,this.sendEvent(n)})),this.runtime.on(l.RuntimeEvent.BREAKPOINT_VALIDATED,(e=>{this.sendEvent(new s.BreakpointEvent("changed",{verified:e.verified,id:e.id}))})),this.runtime.on(l.RuntimeEvent.CONTINUE,(e=>{this.sendEvent(new s.ContinuedEvent(e,!0))})),this.runtime.on(l.RuntimeEvent.END,(()=>{this.sendEvent(new s.TerminatedEvent)})),this.runtime.on(l.RuntimeEvent.OUTPUT,((e,t,n,r,i)=>{let o;o="important"===e||"stdout"===e||"stderr"===e?e:"console";const a=new s.OutputEvent(`${t}`,o);n&&(a.body.source=this.createSource(n)),r&&(a.body.line=this.convertDebuggerLineToClient(r)),i&&(a.body.column=this.convertDebuggerColumnToClient(i)),this.sendEvent(a)}))}async continueRequest(e){this.sendResponse(e),await this.runtime.continue()}async nextRequest(e,t){this.sendResponse(e),await this.runtime.step("instruction"===t.granularity)}async stepInRequest(e){this.sendResponse(e),await this.runtime.stepIn()}async stepOutRequest(e,t){this.sendResponse(e),await this.runtime.stepOut("instruction"===t.granularity)}async setBreakPointsRequest(e,t){const n=this.convertPathToRuntime(t.source.path),r=t.breakpoints||[];await this.runtime.clearBreakpoints(n);const i=await Promise.all(r.map((async e=>{const{verified:t,line:r,column:i,path:o,id:a}=await this.runtime.setBreakPoint(n,this.convertClientLineToDebugger(e.line),e.column?this.convertClientColumnToDebugger(e.column):0),u=new s.Breakpoint(t,this.convertDebuggerLineToClient(r),this.convertDebuggerColumnToClient(i),this.createSource(o));return u.setId(a),u})));e.body={breakpoints:i},this.sendResponse(e)}async stackTraceRequest(e,t){if(this.runtime.currentThread!=t.threadId)return void this.sendResponse(e);const n=await this.runtime.stack();e.body={stackFrames:n.frames.map((e=>{const t=new s.StackFrame(e.index,e.name,this.createSource(e.file),this.convertDebuggerLineToClient(e.line),this.convertDebuggerColumnToClient(e.column));return e.name.startsWith("#")&&(t.presentationHint="subtle"),t})),totalFrames:n.count},this.sendResponse(e)}async evaluateRequest(e,t){let n,r;switch(t.context){case"repl":{const e=/^~(?<cmd>entities)(?: (?<args>.+))?$/i.exec(t.expression);if(e?.groups){if("entities"===e.groups.cmd)n=(await this.runtime.getEntities()).map((e=>e.name)).join("\n")}else r=await this.runtime.evaluate(t.expression);break}case"watch":r=await this.runtime.evaluate(t.expression);break;default:{const[e,n]=t.expression.split(" ");r=void 0===n?await this.runtime.getVariablePreview(e):"entity"===e?await this.runtime.getEntity(n):await this.runtime.getVariablePreview(n,"label"===e);break}}if(r){const t=this.convertDebuggerVariableToClient(r);e.body={result:t.value,variablesReference:t.variablesReference,presentationHint:t.presentationHint}}else e.body={result:n||"???",variablesReference:0};this.sendResponse(e)}scopesRequest(e){e.body={scopes:[new s.Scope("Variables",this._variableHandles.create("vars"),!1),new s.Scope("Labels",this._variableHandles.create("labels"),!0),new s.Scope("Entities",this._variableHandles.create("entities"),!0)]},this.sendResponse(e)}async variablesRequest(e,t,n){let r=[];const s=new AbortController;n&&this.cancellationTokens.set(n.seq,s);try{const e=this._variableHandles.get(t.variablesReference);"vars"===e?r=await this.runtime.getVariables(s.signal):"labels"===e?r=await this.runtime.getLabels():"entities"===e?r=await this.runtime.getEntities():null!=e&&(r=Array.isArray(e.value)?e.value:"entity"===e.category?[await this.runtime.getEntity(e.name)]:e.lazy?[await this.runtime.getVariablePreview(e.name,"label"===e.category)]:[e])}finally{n&&this.cancellationTokens.delete(n.seq)}e.body={variables:r.map((e=>this.convertDebuggerVariableToClient(e)))},this.sendResponse(e)}async setVariableRequest(e,t){const n=this._variableHandles.get(t.variablesReference);let r;"vars"===n?r=await this.runtime.getVariablePreview(t.name):"labels"===n?r=await this.runtime.getVariablePreview(t.name,!0):n instanceof l.RuntimeVariable&&(r=Array.isArray(n.value)?n.value.find((e=>e.name===t.name)):n),r&&(r.value=t.value,await this.runtime.setVariable(r),e.body=this.convertDebuggerVariableToClient(r)),this.sendResponse(e)}cancelRequest(e,t){if(t.requestId){const e=this.cancellationTokens.get(t.requestId);e?.abort()}}configurationDoneRequest(e,t){super.configurationDoneRequest(e,t),this.configurationDone.notify(null)}initializeRequest(e){e.body=e.body||{},e.body.supportsConfigurationDoneRequest=!0,e.body.supportsCancelRequest=!0,e.body.supportSuspendDebuggee=!1,e.body.supportTerminateDebuggee=!0,e.body.supportsSetVariable=!0,e.body.supportsSteppingGranularity=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsCompletionsRequest=!0,e.body.completionTriggerCharacters=["~"],e.body.supportsDataBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsConditionalBreakpoints=!1,this.sendResponse(e),this.sendEvent(new s.InitializedEvent)}completionsRequest(e){e.body={targets:[{label:"entities",detail:"Print out the contained entities.",type:"method"}]},this.sendResponse(e)}async launchRequest(e,t){s.logger.setup(t.logging?s.Logger.LogLevel.Verbose:s.Logger.LogLevel.Stop,!1);const n=this.getExecutablePath(t.executable);if(null==n)return void this.sendErrorResponse(e,{id:2,format:`No Amalgam executable not found at path: ${t.executable||l.AmalgamRuntime.DEFAULT_EXECUTABLE_DIRS.join(" or ")}`,showUser:!0});const i=t.workingDirectory?(0,u.expandUserHome)(t.workingDirectory):void 0;if(null!=i&&!(0,a.existsSync)(i))return void this.sendErrorResponse(e,{id:2,format:`The provided working directory does not exist: ${i}`,showUser:!0});let c=(0,u.expandUserHome)(t.program);i&&(c=o.resolve(i,c));const d=r.Uri.parse(c),h=r.workspace.getWorkspaceFolder(d)?.uri,p=i||o.dirname(d.fsPath),m=t.args||[];if(this.workingDirectory=p||h?.fsPath,await this.configurationDone.wait(1e3),t.tracefile){const e=p?o.resolve(p,t.tracefile):t.tracefile;m.push("--tracefile",`"${e}"`)}const g={cwd:p,executable:n,args:m,program:d.fsPath};await this.runtime.start(g,!!t.stopOnEntry,!t.noDebug)?this.sendResponse(e):this.sendErrorResponse(e,{id:1001,format:"error: failed to start amalgam runtime",showUser:!0})}disconnectRequest(e,t){t.terminateDebuggee&&this.runtime?.terminate()}async threadsRequest(e){const t=await this.runtime.getThreadIds();t.length>0?e.body={threads:t.map((e=>new s.Thread(parseInt(e),`thread ${e}`)))}:e.body={threads:[new s.Thread(l.AmalgamRuntime.DEFAULT_THREAD_ID,"main")]},this.sendResponse(e)}getExecutablePath(e){if(null==e){const t=l.AmalgamRuntime.getExecutableName();for(const n of l.AmalgamRuntime.DEFAULT_EXECUTABLE_DIRS)if(e=o.resolve((0,u.expandUserHome)(n),t),(0,a.existsSync)(e))return e}else if(e=o.resolve((0,u.expandUserHome)(e)),(0,a.existsSync)(e))return e}createSource(e){return this.workingDirectory&&(e=o.resolve(this.workingDirectory,e)),new s.Source(o.basename(e),this.convertDebuggerPathToClient(e))}convertPathToRelative(e){return this.workingDirectory&&(e=o.relative(this.workingDirectory,e)),e}convertPathToRuntime(e){return e=this.convertClientPathToDebugger(e),this.workingDirectory&&(e=o.resolve(this.workingDirectory,e)),"win32"==(0,i.platform)()?(e=o.win32.normalize(e)).charAt(0).toUpperCase()+e.slice(1):o.normalize(e)}convertDebuggerVariableToClient(e){const t={name:e.name,value:"???",variablesReference:0,evaluateName:`${e.category} ${e.name}`};return e.lazy?(e.reference??=this._variableHandles.create(e),t.variablesReference=e.reference,t.value="",t.presentationHint={lazy:e.lazy}):Array.isArray(e.value)?(t.value="Object",e.reference??=this._variableHandles.create(e),t.variablesReference=e.reference):null!=e.value&&(t.value=e.value),t}}t.AmalgamDebugSession=d},292:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.expandUserHome=void 0;const r=n(37);t.expandUserHome=function(e){return e&&"string"==typeof e?e.startsWith("~/")||"~"===e?e.replace("~",(0,r.homedir)()):e:""}},271:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotifySubject=t.NotifyWaiter=void 0;class n{constructor(e,t,n){this.resolveFunc=e,this.cancelFunc=t,this._resolved=!1,null!=n&&(this.timeout=setTimeout((()=>this.resolve(void 0)),n))}get resolved(){return this._resolved}resolve(e){this.resolved||(clearTimeout(this.timeout),this.resolveFunc(e),this._resolved=!0)}cancel(){this.resolved||(clearTimeout(this.timeout),this.cancelFunc(),this._resolved=!0)}}t.NotifyWaiter=n,t.NotifySubject=class{constructor(){this.waiters=[]}async wait(e){return new Promise(((t,r)=>{const s=new n((e=>{this.remove(s),t(e)}),(()=>{this.remove(s),r("cancelled")}),e);this.waiters.push(s)}))}remove(e){const t=this.waiters.indexOf(e);t>=0&&this.waiters.splice(t,1)}notify(e){for(const t of this.waiters)t.resolve(e)}cancel(){for(const e of this.waiters)e.cancel()}}},857:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.activateLanguage=void 0;const r=n(496),s=n(617);t.activateLanguage=function(e){e.subscriptions.push(r.languages.registerDocumentSymbolProvider({scheme:"file",language:"amalgam"},new s.AmalgamDocumentSymbolProvider))}},617:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmalgamDocumentSymbolProvider=void 0;const r=n(496);t.AmalgamDocumentSymbolProvider=class{provideDocumentSymbols(e,t){return new Promise(((n,s)=>{const i=[];let o=null,a=null;const u=e=>{null!=a&&(a.range=new r.Range(a.range.start,new r.Position(e,0)),a=null)};for(let n=0;n<e.lineCount;n++){if(t.isCancellationRequested)return void s("cancelled");const c=e.lineAt(n);if(o){if(/^\s*(?:;.*)?$/.test(c.text))continue;const e=/^\s*(.+)\s*.*$/.exec(c.text);e&&(o.kind=this.checkType(e[1],r.SymbolKind.Function)),u(n),a=o,i.push(o),o=null}else{const e=/^(\s*#)[\^!]?(\w+)\s*(.*)?\s*$/.exec(c.text);if(e){const t=new r.Range(n,e[1].length,n,c.range.end.character),s=new r.Range(n,e[1].length,n,e[1].length+e[2].length);o=new r.DocumentSymbol(e[2],"",r.SymbolKind.Function,t,s),e[3]&&(u(n),o.kind=this.checkType(e[3],r.SymbolKind.Variable),i.push(o),o=null)}}}u(e.lineCount),n(i)}))}checkType(e,t){return/^(?:["'](?:[^"\\]|\\.)*["']|\.nas)(?:\s*;.*)?$/.test(e)?r.SymbolKind.String:/^(?:\d+\.?\d*|\.nan|-?\.infinity)(?:\s*;.*)?$/.test(e)?r.SymbolKind.Number:/^\((?:true|false)\)(?:\s*;.*)?$/i.test(e)?r.SymbolKind.Boolean:/^\(list(?:\s.*)?$/i.test(e)?r.SymbolKind.Array:/^\(assoc(?:\s.*)?$/i.test(e)?r.SymbolKind.Object:/^\(null\)(?:\s*;.*)?$/i.test(e)?r.SymbolKind.Variable:t}}},570:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.Logger=void 0;const r=n(496);class s{constructor(e){this.outputLine=e,this.sourceLength=8}logLine(e,t){if(!t)return;const n=t.replace(/\r/g,"").split("\n");n.length&&""===n[n.length-1]&&n.pop();const r=(new Date).toISOString().replace(/^.*T(.*)Z$/,"$1"),s=e.padEnd(this.sourceLength," ");for(const e of n)this.outputLine(`${r} [${s}] ${e}`)}logText(e,...t){t.map((t=>this.logLine(e,t)))}log(e,...t){const n=t.map((e=>{return"string"==typeof(t=e)?t:t instanceof Buffer?String(t):"object"==typeof t?JSON.stringify(t):String(t);var t}));this.logLine(e,n.join(" "))}info(...e){this.log("info",...e)}warn(...e){this.log("warn",...e)}debug(...e){this.log("debug",...e)}error(...e){this.log("error",...e)}}t.Logger=s,t.logger=function(){const e=r.window.createOutputChannel("Amalgam Runtime");return new s((t=>e.appendLine(t)))}()},496:e=>{e.exports=require("vscode")},81:e=>{e.exports=require("child_process")},361:e=>{e.exports=require("events")},358:e=>{e.exports=require("fs")},808:e=>{e.exports=require("net")},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")},310:e=>{e.exports=require("url")},641:(e,t,n)=>{function r(e,...t){return(...n)=>e(...t,...n)}function s(e){return function(...t){var n=t.pop();return e.call(this,t,n)}}n.r(t),n.d(t,{all:()=>me,allLimit:()=>ge,allSeries:()=>fe,any:()=>tt,anyLimit:()=>nt,anySeries:()=>rt,apply:()=>r,applyEach:()=>P,applyEachSeries:()=>q,asyncify:()=>d,auto:()=>j,autoInject:()=>U,cargo:()=>z,cargoQueue:()=>W,compose:()=>G,concat:()=>Y,concatLimit:()=>X,concatSeries:()=>Z,constant:()=>ee,default:()=>gt,detect:()=>ne,detectLimit:()=>re,detectSeries:()=>se,dir:()=>oe,doDuring:()=>ae,doUntil:()=>ue,doWhilst:()=>ae,during:()=>ht,each:()=>le,eachLimit:()=>de,eachOf:()=>x,eachOfLimit:()=>L,eachOfSeries:()=>C,eachSeries:()=>he,ensureAsync:()=>pe,every:()=>me,everyLimit:()=>ge,everySeries:()=>fe,filter:()=>Ee,filterLimit:()=>Re,filterSeries:()=>we,find:()=>ne,findLimit:()=>re,findSeries:()=>se,flatMap:()=>Y,flatMapLimit:()=>X,flatMapSeries:()=>Z,foldl:()=>Q,foldr:()=>$e,forEach:()=>le,forEachLimit:()=>de,forEachOf:()=>x,forEachOfLimit:()=>L,forEachOfSeries:()=>C,forEachSeries:()=>he,forever:()=>Se,groupBy:()=>Le,groupByLimit:()=>_e,groupBySeries:()=>Te,inject:()=>Q,log:()=>ke,map:()=>O,mapLimit:()=>J,mapSeries:()=>D,mapValues:()=>Oe,mapValuesLimit:()=>xe,mapValuesSeries:()=>Pe,memoize:()=>Ce,nextTick:()=>De,parallel:()=>Ae,parallelLimit:()=>Ie,priorityQueue:()=>Me,queue:()=>je,race:()=>Ue,reduce:()=>Q,reduceRight:()=>$e,reflect:()=>Ve,reflectAll:()=>He,reject:()=>We,rejectLimit:()=>Qe,rejectSeries:()=>Ke,retry:()=>Ye,retryable:()=>Ze,select:()=>Ee,selectLimit:()=>Re,selectSeries:()=>we,seq:()=>K,series:()=>et,setImmediate:()=>l,some:()=>tt,someLimit:()=>nt,someSeries:()=>rt,sortBy:()=>st,timeout:()=>it,times:()=>at,timesLimit:()=>ot,timesSeries:()=>ut,transform:()=>ct,tryEach:()=>lt,unmemoize:()=>dt,until:()=>pt,waterfall:()=>mt,whilst:()=>ht,wrapSync:()=>d});var i="function"==typeof queueMicrotask&&queueMicrotask,o="function"==typeof setImmediate&&setImmediate,a="object"==typeof process&&"function"==typeof process.nextTick;function u(e){setTimeout(e,0)}function c(e){return(t,...n)=>e((()=>t(...n)))}var l=c(i?queueMicrotask:o?setImmediate:a?process.nextTick:u);function d(e){return m(e)?function(...t){const n=t.pop();return h(e.apply(this,t),n)}:s((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return h(r,n);n(null,r)}))}function h(e,t){return e.then((e=>{p(t,null,e)}),(e=>{p(t,e&&e.message?e:new Error(e))}))}function p(e,t,n){try{e(t,n)}catch(e){l((e=>{throw e}),e)}}function m(e){return"AsyncFunction"===e[Symbol.toStringTag]}function g(e){if("function"!=typeof e)throw new Error("expected a function");return m(e)?d(e):e}function f(e,t=e.length){if(!t)throw new Error("arity is undefined");return function(...n){return"function"==typeof n[t-1]?e.apply(this,n):new Promise(((r,s)=>{n[t-1]=(e,...t)=>{if(e)return s(e);r(t.length>1?t:t[0])},e.apply(this,n)}))}}function v(e){return function(t,...n){return f((function(r){var s=this;return e(t,((e,t)=>{g(e).apply(s,n.concat(t))}),r)}))}}function b(e,t,n,r){t=t||[];var s=[],i=0,o=g(n);return e(t,((e,t,n)=>{var r=i++;o(e,((e,t)=>{s[r]=t,n(e)}))}),(e=>{r(e,s)}))}function y(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0}const E={};function R(e){function t(...t){if(null!==e){var n=e;e=null,n.apply(this,t)}}return Object.assign(t,e),t}function w(e){return function(...t){if(null===e)throw new Error("Callback was already called.");var n=e;e=null,n.apply(this,t)}}function S(e,t,n,r){let s=!1,i=!1,o=!1,a=0,u=0;function c(){a>=t||o||s||(o=!0,e.next().then((({value:e,done:t})=>{if(!i&&!s){if(o=!1,t)return s=!0,void(a<=0&&r(null));a++,n(e,u,l),u++,c()}})).catch(d))}function l(e,t){if(a-=1,!i)return e?d(e):!1===e?(s=!0,void(i=!0)):t===E||s&&a<=0?(s=!0,r(null)):void c()}function d(e){i||(o=!1,s=!0,r(e))}c()}var _=e=>(t,n,r)=>{if(r=R(r),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return r(null);if("AsyncGenerator"===t[Symbol.toStringTag])return S(t,e,n,r);if(function(e){return"function"==typeof e[Symbol.asyncIterator]}(t))return S(t[Symbol.asyncIterator](),e,n,r);var s=function(e){if(y(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t,n,r,s,i=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()}(e);return i?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(i):(n=(t=e)?Object.keys(t):[],r=-1,s=n.length,function e(){var i=n[++r];return"__proto__"===i?e():r<s?{value:t[i],key:i}:null})}(t),i=!1,o=!1,a=0,u=!1;function c(e,t){if(!o)if(a-=1,e)i=!0,r(e);else if(!1===e)i=!0,o=!0;else{if(t===E||i&&a<=0)return i=!0,r(null);u||l()}}function l(){for(u=!0;a<e&&!i;){var t=s();if(null===t)return i=!0,void(a<=0&&r(null));a+=1,n(t.value,t.key,w(c))}u=!1}l()},L=f((function(e,t,n,r){return _(t)(e,g(n),r)}),4);function T(e,t,n){n=R(n);var r=0,s=0,{length:i}=e,o=!1;function a(e,t){!1===e&&(o=!0),!0!==o&&(e?n(e):++s!==i&&t!==E||n(null))}for(0===i&&n(null);r<i;r++)t(e[r],r,w(a))}function k(e,t,n){return L(e,1/0,t,n)}var x=f((function(e,t,n){return(y(e)?T:k)(e,g(t),n)}),3),O=f((function(e,t,n){return b(x,e,t,n)}),3),P=v(O),C=f((function(e,t,n){return L(e,1,t,n)}),3),D=f((function(e,t,n){return b(C,e,t,n)}),3),q=v(D);const A=Symbol("promiseCallback");function I(){let e,t;function n(n,...r){if(n)return t(n);e(r.length>1?r:r[0])}return n[A]=new Promise(((n,r)=>{e=n,t=r})),n}function j(e,t,n){"number"!=typeof t&&(n=t,t=null),n=R(n||I());var r=Object.keys(e).length;if(!r)return n(null);t||(t=r);var s={},i=0,o=!1,a=!1,u=Object.create(null),c=[],l=[],d={};function h(e,t){c.push((()=>function(e,t){if(!a){var r=w(((t,...r)=>{if(i--,!1!==t)if(r.length<2&&([r]=r),t){var c={};if(Object.keys(s).forEach((e=>{c[e]=s[e]})),c[e]=r,a=!0,u=Object.create(null),o)return;n(t,c)}else s[e]=r,(u[e]||[]).forEach((e=>e())),p();else o=!0}));i++;var c=g(t[t.length-1]);t.length>1?c(s,r):c(r)}}(e,t)))}function p(){if(!o){if(0===c.length&&0===i)return n(null,s);for(;c.length&&i<t;)c.shift()()}}function m(t){var n=[];return Object.keys(e).forEach((r=>{const s=e[r];Array.isArray(s)&&s.indexOf(t)>=0&&n.push(r)})),n}return Object.keys(e).forEach((t=>{var n=e[t];if(!Array.isArray(n))return h(t,[n]),void l.push(t);var r=n.slice(0,n.length-1),s=r.length;if(0===s)return h(t,n),void l.push(t);d[t]=s,r.forEach((i=>{if(!e[i])throw new Error("async.auto task `"+t+"` has a non-existent dependency `"+i+"` in "+r.join(", "));var o,a;(a=u[o=i])||(a=u[o]=[]),a.push((()=>{0==--s&&h(t,n)}))}))})),function(){for(var e=0;l.length;)e++,m(l.pop()).forEach((e=>{0==--d[e]&&l.push(e)}));if(e!==r)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),p(),n[A]}var B=/^(?:async\s+)?(?:function)?\s*\w*\s*\(\s*([^)]+)\s*\)(?:\s*{)/,F=/^(?:async\s+)?\(?\s*([^)=]+)\s*\)?(?:\s*=>)/,N=/,/,M=/(=.+)?(\s*)$/;function U(e,t){var n={};return Object.keys(e).forEach((t=>{var r,s=e[t],i=m(s),o=!i&&1===s.length||i&&0===s.length;if(Array.isArray(s))r=[...s],s=r.pop(),n[t]=r.concat(r.length>0?a:s);else if(o)n[t]=s;else{if(r=function(e){const t=function(e){let t="",n=0,r=e.indexOf("*/");for(;n<e.length;)if("/"===e[n]&&"/"===e[n+1]){let t=e.indexOf("\n",n);n=-1===t?e.length:t}else if(-1!==r&&"/"===e[n]&&"*"===e[n+1]){let s=e.indexOf("*/",n);-1!==s?(n=s+2,r=e.indexOf("*/",n)):(t+=e[n],n++)}else t+=e[n],n++;return t}(e.toString());let n=t.match(B);if(n||(n=t.match(F)),!n)throw new Error("could not parse args in autoInject\nSource:\n"+t);let[,r]=n;return r.replace(/\s/g,"").split(N).map((e=>e.replace(M,"").trim()))}(s),0===s.length&&!i&&0===r.length)throw new Error("autoInject task functions require explicit parameters.");i||r.pop(),n[t]=r.concat(a)}function a(e,t){var n=r.map((t=>e[t]));n.push(t),g(s)(...n)}})),j(n,t)}class ${constructor(){this.head=this.tail=null,this.length=0}removeLink(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e}empty(){for(;this.head;)this.shift();return this}insertAfter(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1}insertBefore(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1}unshift(e){this.head?this.insertBefore(this.head,e):V(this,e)}push(e){this.tail?this.insertAfter(this.tail,e):V(this,e)}shift(){return this.head&&this.removeLink(this.head)}pop(){return this.tail&&this.removeLink(this.tail)}toArray(){return[...this]}*[Symbol.iterator](){for(var e=this.head;e;)yield e.data,e=e.next}remove(e){for(var t=this.head;t;){var{next:n}=t;e(t)&&this.removeLink(t),t=n}return this}}function V(e,t){e.length=1,e.head=e.tail=t}function H(e,t,n){if(null==t)t=1;else if(0===t)throw new RangeError("Concurrency must not be zero");var r=g(e),s=0,i=[];const o={error:[],drain:[],saturated:[],unsaturated:[],empty:[]};function a(e,t){return e?t?void(o[e]=o[e].filter((e=>e!==t))):o[e]=[]:Object.keys(o).forEach((e=>o[e]=[]))}function u(e,...t){o[e].forEach((e=>e(...t)))}var c=!1;function d(e,t,n,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");var s,i;function o(e,...t){return e?n?i(e):s():t.length<=1?s(t[0]):void s(t)}v.started=!0;var a=v._createTaskItem(e,n?o:r||o);if(t?v._tasks.unshift(a):v._tasks.push(a),c||(c=!0,l((()=>{c=!1,v.process()}))),n||!r)return new Promise(((e,t)=>{s=e,i=t}))}function h(e){return function(t,...n){s-=1;for(var r=0,o=e.length;r<o;r++){var a=e[r],c=i.indexOf(a);0===c?i.shift():c>0&&i.splice(c,1),a.callback(t,...n),null!=t&&u("error",t,a.data)}s<=v.concurrency-v.buffer&&u("unsaturated"),v.idle()&&u("drain"),v.process()}}function p(e){return!(0!==e.length||!v.idle()||(l((()=>u("drain"))),0))}const m=e=>t=>{if(!t)return new Promise(((t,n)=>{!function(e,r){const s=(...r)=>{a(e,s),((e,r)=>{if(e)return n(e);t(r)})(...r)};o[e].push(s)}(e)}));a(e),function(e,t){o[e].push(t)}(e,t)};var f=!1,v={_tasks:new $,_createTaskItem:(e,t)=>({data:e,callback:t}),*[Symbol.iterator](){yield*v._tasks[Symbol.iterator]()},concurrency:t,payload:n,buffer:t/4,started:!1,paused:!1,push(e,t){if(Array.isArray(e)){if(p(e))return;return e.map((e=>d(e,!1,!1,t)))}return d(e,!1,!1,t)},pushAsync(e,t){if(Array.isArray(e)){if(p(e))return;return e.map((e=>d(e,!1,!0,t)))}return d(e,!1,!0,t)},kill(){a(),v._tasks.empty()},unshift(e,t){if(Array.isArray(e)){if(p(e))return;return e.map((e=>d(e,!0,!1,t)))}return d(e,!0,!1,t)},unshiftAsync(e,t){if(Array.isArray(e)){if(p(e))return;return e.map((e=>d(e,!0,!0,t)))}return d(e,!0,!0,t)},remove(e){v._tasks.remove(e)},process(){if(!f){for(f=!0;!v.paused&&s<v.concurrency&&v._tasks.length;){var e=[],t=[],n=v._tasks.length;v.payload&&(n=Math.min(n,v.payload));for(var o=0;o<n;o++){var a=v._tasks.shift();e.push(a),i.push(a),t.push(a.data)}s+=1,0===v._tasks.length&&u("empty"),s===v.concurrency&&u("saturated");var c=w(h(e));r(t,c)}f=!1}},length:()=>v._tasks.length,running:()=>s,workersList:()=>i,idle:()=>v._tasks.length+s===0,pause(){v.paused=!0},resume(){!1!==v.paused&&(v.paused=!1,l(v.process))}};return Object.defineProperties(v,{saturated:{writable:!1,value:m("saturated")},unsaturated:{writable:!1,value:m("unsaturated")},empty:{writable:!1,value:m("empty")},drain:{writable:!1,value:m("drain")},error:{writable:!1,value:m("error")}}),v}function z(e,t){return H(e,1,t)}function W(e,t,n){return H(e,t,n)}var Q=f((function(e,t,n,r){r=R(r);var s=g(n);return C(e,((e,n,r)=>{s(t,e,((e,n)=>{t=n,r(e)}))}),(e=>r(e,t)))}),4);function K(...e){var t=e.map(g);return function(...e){var n=this,r=e[e.length-1];return"function"==typeof r?e.pop():r=I(),Q(t,e,((e,t,r)=>{t.apply(n,e.concat(((e,...t)=>{r(e,t)})))}),((e,t)=>r(e,...t))),r[A]}}function G(...e){return K(...e.reverse())}var J=f((function(e,t,n,r){return b(_(t),e,n,r)}),4),X=f((function(e,t,n,r){var s=g(n);return J(e,t,((e,t)=>{s(e,((e,...n)=>e?t(e):t(e,n)))}),((e,t)=>{for(var n=[],s=0;s<t.length;s++)t[s]&&(n=n.concat(...t[s]));return r(e,n)}))}),4),Y=f((function(e,t,n){return X(e,1/0,t,n)}),3),Z=f((function(e,t,n){return X(e,1,t,n)}),3);function ee(...e){return function(...t){return t.pop()(null,...e)}}function te(e,t){return(n,r,s,i)=>{var o,a=!1;const u=g(s);n(r,((n,r,s)=>{u(n,((r,i)=>r||!1===r?s(r):e(i)&&!o?(a=!0,o=t(!0,n),s(null,E)):void s()))}),(e=>{if(e)return i(e);i(null,a?o:t(!1))}))}}var ne=f((function(e,t,n){return te((e=>e),((e,t)=>t))(x,e,t,n)}),3),re=f((function(e,t,n,r){return te((e=>e),((e,t)=>t))(_(t),e,n,r)}),4),se=f((function(e,t,n){return te((e=>e),((e,t)=>t))(_(1),e,t,n)}),3);function ie(e){return(t,...n)=>g(t)(...n,((t,...n)=>{"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&n.forEach((t=>console[e](t))))}))}var oe=ie("dir"),ae=f((function(e,t,n){n=w(n);var r,s=g(e),i=g(t);function o(e,...t){if(e)return n(e);!1!==e&&(r=t,i(...t,a))}function a(e,t){return e?n(e):!1!==e?t?void s(o):n(null,...r):void 0}return a(null,!0)}),3);function ue(e,t,n){const r=g(t);return ae(e,((...e)=>{const t=e.pop();r(...e,((e,n)=>t(e,!n)))}),n)}function ce(e){return(t,n,r)=>e(t,r)}var le=f((function(e,t,n){return x(e,ce(g(t)),n)}),3),de=f((function(e,t,n,r){return _(t)(e,ce(g(n)),r)}),4),he=f((function(e,t,n){return de(e,1,t,n)}),3);function pe(e){return m(e)?e:function(...t){var n=t.pop(),r=!0;t.push(((...e)=>{r?l((()=>n(...e))):n(...e)})),e.apply(this,t),r=!1}}var me=f((function(e,t,n){return te((e=>!e),(e=>!e))(x,e,t,n)}),3),ge=f((function(e,t,n,r){return te((e=>!e),(e=>!e))(_(t),e,n,r)}),4),fe=f((function(e,t,n){return te((e=>!e),(e=>!e))(C,e,t,n)}),3);function ve(e,t,n,r){var s=new Array(t.length);e(t,((e,t,r)=>{n(e,((e,n)=>{s[t]=!!n,r(e)}))}),(e=>{if(e)return r(e);for(var n=[],i=0;i<t.length;i++)s[i]&&n.push(t[i]);r(null,n)}))}function be(e,t,n,r){var s=[];e(t,((e,t,r)=>{n(e,((n,i)=>{if(n)return r(n);i&&s.push({index:t,value:e}),r(n)}))}),(e=>{if(e)return r(e);r(null,s.sort(((e,t)=>e.index-t.index)).map((e=>e.value)))}))}function ye(e,t,n,r){return(y(t)?ve:be)(e,t,g(n),r)}var Ee=f((function(e,t,n){return ye(x,e,t,n)}),3),Re=f((function(e,t,n,r){return ye(_(t),e,n,r)}),4),we=f((function(e,t,n){return ye(C,e,t,n)}),3),Se=f((function(e,t){var n=w(t),r=g(pe(e));return function e(t){if(t)return n(t);!1!==t&&r(e)}()}),2),_e=f((function(e,t,n,r){var s=g(n);return J(e,t,((e,t)=>{s(e,((n,r)=>n?t(n):t(n,{key:r,val:e})))}),((e,t)=>{for(var n={},{hasOwnProperty:s}=Object.prototype,i=0;i<t.length;i++)if(t[i]){var{key:o}=t[i],{val:a}=t[i];s.call(n,o)?n[o].push(a):n[o]=[a]}return r(e,n)}))}),4);function Le(e,t,n){return _e(e,1/0,t,n)}function Te(e,t,n){return _e(e,1,t,n)}var ke=ie("log"),xe=f((function(e,t,n,r){r=R(r);var s={},i=g(n);return _(t)(e,((e,t,n)=>{i(e,t,((e,r)=>{if(e)return n(e);s[t]=r,n(e)}))}),(e=>r(e,s)))}),4);function Oe(e,t,n){return xe(e,1/0,t,n)}function Pe(e,t,n){return xe(e,1,t,n)}function Ce(e,t=(e=>e)){var n=Object.create(null),r=Object.create(null),i=g(e),o=s(((e,s)=>{var o=t(...e);o in n?l((()=>s(null,...n[o]))):o in r?r[o].push(s):(r[o]=[s],i(...e,((e,...t)=>{e||(n[o]=t);var s=r[o];delete r[o];for(var i=0,a=s.length;i<a;i++)s[i](e,...t)})))}));return o.memo=n,o.unmemoized=e,o}var De=c(a?process.nextTick:o?setImmediate:u),qe=f(((e,t,n)=>{var r=y(t)?[]:{};e(t,((e,t,n)=>{g(e)(((e,...s)=>{s.length<2&&([s]=s),r[t]=s,n(e)}))}),(e=>n(e,r)))}),3);function Ae(e,t){return qe(x,e,t)}function Ie(e,t,n){return qe(_(t),e,n)}function je(e,t){var n=g(e);return H(((e,t)=>{n(e[0],t)}),t,1)}class Be{constructor(){this.heap=[],this.pushCount=Number.MIN_SAFE_INTEGER}get length(){return this.heap.length}empty(){return this.heap=[],this}percUp(e){let t;for(;e>0&&Ne(this.heap[e],this.heap[t=Fe(e)]);){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}percDown(e){let t;for(;(t=1+(e<<1))<this.heap.length&&(t+1<this.heap.length&&Ne(this.heap[t+1],this.heap[t])&&(t+=1),!Ne(this.heap[e],this.heap[t]));){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}push(e){e.pushCount=++this.pushCount,this.heap.push(e),this.percUp(this.heap.length-1)}unshift(e){return this.heap.push(e)}shift(){let[e]=this.heap;return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.percDown(0),e}toArray(){return[...this]}*[Symbol.iterator](){for(let e=0;e<this.heap.length;e++)yield this.heap[e].data}remove(e){let t=0;for(let n=0;n<this.heap.length;n++)e(this.heap[n])||(this.heap[t]=this.heap[n],t++);this.heap.splice(t);for(let e=Fe(this.heap.length-1);e>=0;e--)this.percDown(e);return this}}function Fe(e){return(e+1>>1)-1}function Ne(e,t){return e.priority!==t.priority?e.priority<t.priority:e.pushCount<t.pushCount}function Me(e,t){var n=je(e,t),{push:r,pushAsync:s}=n;function i(e,t){return Array.isArray(e)?e.map((e=>({data:e,priority:t}))):{data:e,priority:t}}return n._tasks=new Be,n._createTaskItem=({data:e,priority:t},n)=>({data:e,priority:t,callback:n}),n.push=function(e,t=0,n){return r(i(e,t),n)},n.pushAsync=function(e,t=0,n){return s(i(e,t),n)},delete n.unshift,delete n.unshiftAsync,n}var Ue=f((function(e,t){if(t=R(t),!Array.isArray(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var n=0,r=e.length;n<r;n++)g(e[n])(t)}),2);function $e(e,t,n,r){var s=[...e].reverse();return Q(s,t,n,r)}function Ve(e){var t=g(e);return s((function(e,n){return e.push(((e,...t)=>{let r={};if(e&&(r.error=e),t.length>0){var s=t;t.length<=1&&([s]=t),r.value=s}n(null,r)})),t.apply(this,e)}))}function He(e){var t;return Array.isArray(e)?t=e.map(Ve):(t={},Object.keys(e).forEach((n=>{t[n]=Ve.call(this,e[n])}))),t}function ze(e,t,n,r){const s=g(n);return ye(e,t,((e,t)=>{s(e,((e,n)=>{t(e,!n)}))}),r)}var We=f((function(e,t,n){return ze(x,e,t,n)}),3),Qe=f((function(e,t,n,r){return ze(_(t),e,n,r)}),4),Ke=f((function(e,t,n){return ze(C,e,t,n)}),3);function Ge(e){return function(){return e}}const Je=5,Xe=0;function Ye(e,t,n){var r={times:Je,intervalFunc:Ge(Xe)};if(arguments.length<3&&"function"==typeof e?(n=t||I(),t=e):(function(e,t){if("object"==typeof t)e.times=+t.times||Je,e.intervalFunc="function"==typeof t.interval?t.interval:Ge(+t.interval||Xe),e.errorFilter=t.errorFilter;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");e.times=+t||Je}}(r,e),n=n||I()),"function"!=typeof t)throw new Error("Invalid arguments for async.retry");var s=g(t),i=1;return function e(){s(((t,...s)=>{!1!==t&&(t&&i++<r.times&&("function"!=typeof r.errorFilter||r.errorFilter(t))?setTimeout(e,r.intervalFunc(i-1)):n(t,...s))}))}(),n[A]}function Ze(e,t){t||(t=e,e=null);let n=e&&e.arity||t.length;m(t)&&(n+=1);var r=g(t);return s(((t,s)=>{function i(e){r(...t,e)}return(t.length<n-1||null==s)&&(t.push(s),s=I()),e?Ye(e,i,s):Ye(i,s),s[A]}))}function et(e,t){return qe(C,e,t)}var tt=f((function(e,t,n){return te(Boolean,(e=>e))(x,e,t,n)}),3),nt=f((function(e,t,n,r){return te(Boolean,(e=>e))(_(t),e,n,r)}),4),rt=f((function(e,t,n){return te(Boolean,(e=>e))(C,e,t,n)}),3),st=f((function(e,t,n){var r=g(t);return O(e,((e,t)=>{r(e,((n,r)=>{if(n)return t(n);t(n,{value:e,criteria:r})}))}),((e,t)=>{if(e)return n(e);n(null,t.sort(s).map((e=>e.value)))}));function s(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}}),3);function it(e,t,n){var r=g(e);return s(((s,i)=>{var o,a=!1;s.push(((...e)=>{a||(i(...e),clearTimeout(o))})),o=setTimeout((function(){var t=e.name||"anonymous",r=new Error('Callback function "'+t+'" timed out.');r.code="ETIMEDOUT",n&&(r.info=n),a=!0,i(r)}),t),r(...s)}))}function ot(e,t,n,r){var s=g(n);return J(function(e){for(var t=Array(e);e--;)t[e]=e;return t}(e),t,s,r)}function at(e,t,n){return ot(e,1/0,t,n)}function ut(e,t,n){return ot(e,1,t,n)}function ct(e,t,n,r){arguments.length<=3&&"function"==typeof t&&(r=n,n=t,t=Array.isArray(e)?[]:{}),r=R(r||I());var s=g(n);return x(e,((e,n,r)=>{s(t,e,n,r)}),(e=>r(e,t))),r[A]}var lt=f((function(e,t){var n,r=null;return he(e,((e,t)=>{g(e)(((e,...s)=>{if(!1===e)return t(e);s.length<2?[n]=s:n=s,r=e,t(e?null:{})}))}),(()=>t(r,n)))}));function dt(e){return(...t)=>(e.unmemoized||e)(...t)}var ht=f((function(e,t,n){n=w(n);var r=g(t),s=g(e),i=[];function o(e,...t){if(e)return n(e);i=t,!1!==e&&s(a)}function a(e,t){return e?n(e):!1!==e?t?void r(o):n(null,...i):void 0}return s(a)}),3);function pt(e,t,n){const r=g(e);return ht((e=>r(((t,n)=>e(t,!n)))),t,n)}var mt=f((function(e,t){if(t=R(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var n=0;function r(t){g(e[n++])(...t,w(s))}function s(s,...i){if(!1!==s)return s||n===e.length?t(s,...i):void r(i)}r([])}));const gt={apply:r,applyEach:P,applyEachSeries:q,asyncify:d,auto:j,autoInject:U,cargo:z,cargoQueue:W,compose:G,concat:Y,concatLimit:X,concatSeries:Z,constant:ee,detect:ne,detectLimit:re,detectSeries:se,dir:oe,doUntil:ue,doWhilst:ae,each:le,eachLimit:de,eachOf:x,eachOfLimit:L,eachOfSeries:C,eachSeries:he,ensureAsync:pe,every:me,everyLimit:ge,everySeries:fe,filter:Ee,filterLimit:Re,filterSeries:we,forever:Se,groupBy:Le,groupByLimit:_e,groupBySeries:Te,log:ke,map:O,mapLimit:J,mapSeries:D,mapValues:Oe,mapValuesLimit:xe,mapValuesSeries:Pe,memoize:Ce,nextTick:De,parallel:Ae,parallelLimit:Ie,priorityQueue:Me,queue:je,race:Ue,reduce:Q,reduceRight:$e,reflect:Ve,reflectAll:He,reject:We,rejectLimit:Qe,rejectSeries:Ke,retry:Ye,retryable:Ze,seq:K,series:et,setImmediate:l,some:tt,someLimit:nt,someSeries:rt,sortBy:st,timeout:it,times:at,timesLimit:ot,timesSeries:ut,transform:ct,tryEach:lt,unmemoize:dt,until:pt,waterfall:mt,whilst:ht,all:me,allLimit:ge,allSeries:fe,any:tt,anyLimit:nt,anySeries:rt,find:ne,findLimit:re,findSeries:se,flatMap:Y,flatMapLimit:X,flatMapSeries:Z,forEach:le,forEachSeries:he,forEachLimit:de,forEachOf:x,forEachOfSeries:C,forEachOfLimit:L,inject:Q,foldl:Q,foldr:$e,select:Ee,selectLimit:Re,selectSeries:we,wrapSync:d,during:ht,doDuring:ae}}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(324),s=n(857),i=n(976),o="inline";e.activate=function(e){switch(o){case"inline":(0,t.activateDebug)(e,new i.InlineDebugAdapterFactory);break;case"external":(0,t.activateDebug)(e,new i.ExternalDebugAdapterFactory);break;default:throw new Error(`Run mode '${o}' not implemented`)}(0,s.activateLanguage)(e)},e.deactivate=function(){}})(),module.exports=r})();